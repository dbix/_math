#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#define cordic_1K 0x26DD3B6A
#define half_pi 0x6487ED51
#define MUL 1073741824.000000
#define CORDIC_NTAB 32
int cordic_ctab [] = {
  0x3243F6A8, 0x1DAC6705, 0x0FADBAFC, 0x07F56EA6, 
  0x03FEAB76, 0x01FFD55B, 0x00FFFAAA, 0x007FFF55, 
  0x003FFFEA, 0x001FFFFD, 0x000FFFFF, 0x0007FFFF, 
  0x0003FFFF, 0x0001FFFF, 0x0000FFFF, 0x00007FFF, 
  0x00003FFF, 0x00001FFF, 0x00000FFF, 0x000007FF, 
  0x000003FF, 0x000001FF, 0x000000FF, 0x0000007F, 
  0x0000003F, 0x0000001F, 0x0000000F, 0x00000008, 
  0x00000004, 0x00000002, 0x00000001, 0x00000000
};

double atan_table[] = {
    0.7853981633974482789994908671360462903976, 0.4636476090008061490266300097573548555374,
    0.2449786631268641434733268624768243171275, 0.1243549945467614381566789916178095154464,
    0.06241880999595735002305474381500971503556, 0.0312398334302682774421544564802388777025,
    0.0156237286204768312941615349132007395383, 0.00781234106010111114398730691732453124132,
    0.003906230131966971757390139075027946091723, 0.001953122516478818758434155000713872141205,
    0.000976562189559319459436492749659919354599, 0.0004882812111948982899262139412144279049244,
    0.0002441406201493617712447448120371973345755, 0.0001220703118936702078530659454358442417288,
    6.103515617420877259350145416227917394281e-05, 3.051757811552609572715473451598455767453e-05,
    1.525878906131576154237786818734790017515e-05, 7.629394531101969981038996709843402754814e-06,
    3.814697265606496141750756181942882960811e-06, 1.907348632810186964779285319349089178331e-06,
    9.536743164059608441276310632217505514063e-07, 4.768371582030888422810640820542760209833e-07,
    2.384185791015579736676881098325631036516e-07, 1.192092895507806808997385635169596884708e-07,
    5.960464477539055220810609533356461131604e-08, 2.98023223876953025738326493636679015431e-08,
    1.490116119384765459563877489394465025718e-08, 7.450580596923828125e-09,
    3.7252902984619140625e-09, 1.86264514923095703125e-09,
    9.31322574615478515625e-10, 4.656612873077392578125e-10,
    2.3283064365386962890625e-10, 1.16415321826934814453125e-10,
    5.82076609134674072265625e-11, 2.910383045673370361328125e-11,
    1.4551915228366851806640625e-11, 7.2759576141834259033203125e-12,
    3.63797880709171295166015625e-12, 1.818989403545856475830078125e-12
};

void cordic(int theta, int *s, int *c, int n)
{
  int k, d, tx, ty, tz;
  int x=cordic_1K, y=0, z=theta;
  n = (n>CORDIC_NTAB) ? CORDIC_NTAB : n;
  for (k=0; k<n; ++k) {
    d = z>>31;
    tx = x - (((y>>k) ^ d) - d);
    ty = y + (((x>>k) ^ d) - d);
    tz = z - ((cordic_ctab[k] ^ d) - d);
    x = tx; y = ty; z = tz;
  }
  *c = x;
  *s = y;
    printf("%f, %f", x, y);
}

/* cos(0.5) sin(0.5) = {0.479, 0.878} */


#define A40 0.607252935008881
double cordic_sin(double z) {
  int i;
  int d = 1;
  double x = 1 / A40;
  double y = 0;
  for (i=0; i<40; i++) {
    if (z >= 0)
      d = 1;
    else
      d = -1;
    z = z - d*atan_table[i];
    y = y + x*d*pow(2, -i);
    x = x - y*d*pow(2, -i);
  }
  printf("cos(z) = %f\nsin(z) = %f", x, y);
  return z;
}

int main()
{
    int *s = (int *)malloc(sizeof(int *));
    int *c = (int *)malloc(sizeof(int *));
    cordic(0.5, s, c, 40);
    printf("%f, %f", *s, *c);
    return 0;
}
